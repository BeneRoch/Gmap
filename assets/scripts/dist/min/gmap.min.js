var BB;function init_infoBox(){BB.gmap.infobox.prototype=new google.maps.OverlayView,BB.gmap.infobox.prototype.remove=function(){if(this._div){try{this._div.parentNode.removeChild(this._div)}catch(t){}this._div=null}},BB.gmap.infobox.prototype.set_position=function(t){if(!t)return this;if("string"==typeof t&&(t=t.split(",")),!(t instanceof google.maps.LatLng)){if(void 0===t[0]||void 0===t[1])return this;t=new google.maps.LatLng(t[0],t[1])}return this.opts.position=t,this.map&&this.draw(),this},BB.gmap.infobox.prototype.set_map=function(t){this.__MAP=t,this.setMap(this.__MAP)},BB.gmap.infobox.prototype.draw=function(){this.createElement(),google.maps.event.trigger(this.__MAP,"infobox_opened",{elem:this});var t=this.getProjection().fromLatLngToDivPixel(this.opts.position);t&&(this._div.style.width=this._width+"px",this._div.style.left=t.x+this._offsetX+"px",this._div.style.height=this._height+"px",this._div.style.top=t.y+this._offsetY+"px",this._div.style.display="block",this._div.style.zIndex=1)},BB.gmap.infobox.prototype.createElement=function(){this.generateInfoboxContent();var t=this.getPanes(),e=this._div;if(e&&e.parentNode!=t.floatPane)try{e.parentNode.removeChild(e)}catch(t){}e||((e=this._div=document.createElement("div")).style.border="0",e.style.position="absolute"),e.innerHTML="",e.appendChild(this.__ELEM),t.floatPane.appendChild(e),this._height=this.__ELEM.offsetHeight,this._width=this.__ELEM.offsetWidth,e.style.width=this._width+"px",e.style.height=this._height+"px";e.setAttribute("class","gmap_infobox");var o=this.opts.placement.split(" ");switch(o[0]){case"top":this._offsetY=-parseFloat(this.opts.offsetY);break;case"over":this._offsetY=-parseFloat(this.opts.offsetY)-parseInt(this._height);break;case"bottom":this._offsetY=-parseFloat(this._height);break;case"under":this._offsetY=0;break;case"center":this._offsetY=-parseFloat(this.opts.offsetY)/2-parseInt(this._height)/2}switch(o[1]){case"right":this._offsetX=parseFloat(this.opts.offsetX)-parseInt(this._width);break;case"left":this._offsetX=-parseFloat(this.opts.offsetX);break;case"center":this._offsetX=-parseInt(this._width)/2;break;case"out-right":this._offsetX=parseFloat(this.opts.offsetX);break;case"out-left":this._offsetX=-parseFloat(this.opts.offsetX)-parseInt(this._width)}},BB.gmap.infobox.prototype.generateInfoboxContent=function(){var t=this.infoboxContent;if("function"==typeof t&&(t=t(this.__MARKER.data())),"number"==typeof t&&(t=t.toString()),"string"==typeof t){var e=document.getElementById(t);e||((e=document.createElement("div")).style.position="absolute",e.innerHTML=t),t=e}return t instanceof jQuery&&(t=t.get(0)),this.__ELEM=t,this},BB.gmap.infobox.prototype.refresh=function(){this.generateInfoboxContent()}}(BB=BB||{}).base=function(){this.__BB_DEBUG__=!1,this.__PROTECTED__=[],this._data=void 0},BB.base.prototype.set_data=function(t){return void 0===this._data&&(this._data=new BB.data),"object"!=typeof t||this._data.set_data(t),this},BB.base.prototype.remove_data=function(t){return this._data.remove_data(t),this},BB.base.prototype.get_data=function(t){var e=this.data();return void 0!==e[t]&&e[t]},BB.base.prototype.data=function(t){return this._data.get_data(t)},BB.base.prototype.sanitize=function(){var t=this.data();return t=this._escape_data(t),this.set_data(t),this},BB.base.prototype._escape_data=function(t){if(void 0===t)return"";if("object"==typeof t&&t.length)for(var e=0,o=t.length;e<o;e++)t[e]=this._escape_data(t[e]);if("object"==typeof t)for(var i in t)t[i]=this._escape_data(t[i]);return"string"==typeof t?escape(t):t},BB.base.prototype._unescape_data=function(t){if(void 0===t)return"";if("object"==typeof t)for(var e in t)t[e]=this._unescape_data(t[e]);return"string"==typeof t?unescape(t):t},BB.base.prototype.ident=function(){var t=this.data();return"string"!=typeof t.ident?(this.error("Ident is not a String which is odd. "+t.ident),""):t.ident},BB.base.prototype.set_ident=function(t){return"string"!=typeof t&&(t=""+t,this.error("Ident must be a string. Automatically converted to : "+t)),this.set_data({ident:t}),this},BB.base.prototype.error=function(t){if(this.__BB_DEBUG__)throw Error(t);return this},BB.base.prototype.is_empty_object=function(t){if("object"!=typeof t)return this.error("Invalid argument, Object expected at BB.base.is_empty_object()"),!0;for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},BB.base.prototype.extend=function(t,e){var o,i={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(i[o]=t[o]);for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&(i[o]=e[o]);return i},(BB=BB||{}).data=function(t){if(this.__PROTECTED__=[],this.__HIDDEN_DATA__=!0,this.__HIDDEN_DATA__){var o=t||{};return{set_data:function(t){for(var e in t)o[e]=t[e]},get_data:function(t){return t?void 0!==o[t]?o[t]:"":o},remove_data:function(t){t||(o={}),void 0!==o[t]&&(o[t]=void 0,delete o[t])}}}return this.__DATA=t||{},this.set_data=function(t){if(this.__DATA){if(t)for(var e in t)this.__DATA[e]=t[e]}else this.__DATA=t||{}},this.get_data=function(t){return t?void 0!==this.__DATA[t]?this.__DATA[t]:void 0:this.__DATA},this.remove_data=function(t){t||(this.__DATA={}),void 0!==this.__DATA[t]&&(this.__DATA[t]=void 0,delete this.__DATA[t])},this},(BB=BB||{}).gmap=BB.gmap||{},BB.gmap.controller=function(t,e){return this._MAP=void 0,this.__CONTAINER=t,this.__PLACES={},this.__FOCUSED_ITEM=void 0,this.__CLUSTERER=void 0,this.xhrs=void 0,this.set_data(e),this},BB.gmap.controller.prototype=new BB.base,BB.gmap.controller.prototype.map=function(){return this._MAP?this._MAP:(this.error("No map associated to the current controller at BB.gmap.controller.map()"),!1)},BB.gmap.controller.prototype.loading_place=function(t){var e=this.get_place(t);return e&&e.set_data({loaded:!1}),this},BB.gmap.controller.prototype.place_loaded=function(t){return t?!t.data("loaded")&&(t.set_data({loaded:!0}),this.check_loaded_places()&&this.data("tiles_loaded")&&this._ready(),this):this},BB.gmap.controller.prototype.check_loaded_places=function(){var e=!0;return this._loop_all(function(t){e=!(!e||!t.data("loaded"))}),e},BB.gmap.controller.prototype.ready=function(t){return"function"==typeof t&&this.set_data({map_ready:t}),this},BB.gmap.controller.prototype._ready=function(){var t=this.data();return this.data("loaded")||("function"==typeof t.map_ready&&t.map_ready(this),this.set_data({loaded:!0})),this},BB.gmap.controller.prototype.container=function(){return this.__CONTAINER},BB.gmap.controller.prototype.init=function(){if(this.map())return this;var t=this.data("options");return this._MAP=new google.maps.Map(this.container(),t),"object"!=typeof this.data("places")?this.error("You haven't set any places yet"):this.add_places(this.data("places")),this.listeners(),this},BB.gmap.controller.prototype.set_styles=function(t){"object"!=typeof t&&this.error("Invalid type styles in BB.gmap.set_styles()"+t);var e=this.data("map");return e.styles=t,this.data("map",e),this.map()&&this.map().setOptions({styles:t}),this},BB.gmap.controller.prototype.add_by_url=function(t,e,s){function r(t,e){var o,i,s,r;for(i=(o=e.split(".")).length,s=0,r=t;s<i;s++){if(void 0===r[o[s]])return t;r=r[o[s]]}return r}function o(t,e){var o={};for(var i in s)o[i]=r(t,s[i]);return o}s={id:"id",type:"type",coords:"coords",raw:"raw.mLatitude",date:"raw.mDate"};var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);"string"==typeof e&&""!=e&&(t=r(t,e)),t.hasOwnProperty("map")&&(t=t.map(o))}},i.open("GET",t,!0),i.setRequestHeader("Content-type","application/json; charset=utf-8"),i.send()},BB.gmap.controller.prototype.add_places=function(t){if("object"!=typeof t)return this.error("Invalid places specified :"+t),this;for(var e in t)this.add_place(e,t[e]);return this},BB.gmap.controller.prototype.add_place=function(t,e){if(!e)return this.error("Missing parameter BB.gmap.controller.prototype.add_place ( ident, data ) : ( "+t+", "+e+" )"),this;if("string"!=typeof e.type)return this.error('Missing parameter "type" in BB.gmap.controller.prototype.add_place'),this;switch(e.ident=t,e.type){case"marker":this.set_place(t,new BB.gmap.marker(e,this));break;case"richmarker":this.set_place(t,new BB.gmap.richmarker(e,this));break;case"line":var o=this.default_styles();void 0===e.styles&&(e.styles=o),this.set_place(t,new BB.gmap.line(e,this));break;case"polygon":o=this.default_styles();void 0===e.styles&&(e.styles=o),this.set_place(t,new BB.gmap.polygon(e,this))}return this},BB.gmap.controller.prototype.set_place=function(t,e){return t&&e?(e.set_ident(t),this.__PLACES[t]=e):this.error("Missing parameters in BB.gmap.controller.set_place( "+t+", "+e+")"),this},BB.gmap.controller.prototype.get_places=function(){return this.__PLACES},BB.gmap.controller.prototype.get_place=function(t){var e=this.get_places();return void 0===e[t]?(this.error("Invalid ident at BB.gmap.controller.get_place( ident ) : "+t),!1):e[t]},BB.gmap.controller.prototype.add_place_by_address=function(e,t,o){var i=this;this.geocode_address(t,function(t){o.coords=t,i.add_place(e,o)})},BB.gmap.controller.prototype.geocode_address=function(t,s){var r=Array();if("undefined"==typeof google)return error;(new google.maps.Geocoder).geocode({address:t},function(t,e){if(e===google.maps.GeocoderStatus.OK){var o=t[0].geometry.location.lat(),i=t[0].geometry.location.lng();"function"==typeof s&&s([o,i])}return r})},BB.gmap.controller.prototype.remove_focus=function(t){var e=this.focused(t);if(this.data("multiple")&&!t){for(var o in e){var i=e[o];if(this.__FOCUSED_ITEM[o]=void 0,delete this.__FOCUSED_ITEM[o],i.blur(),"function"==typeof this.data("onblur"))this.data("onblur")(i,this)}return this}e&&(this.data("multiple")?(this.__FOCUSED_ITEM[t]=void 0,delete this.__FOCUSED_ITEM[t]):this.__FOCUSED_ITEM=void 0,e.blur(),"function"==typeof this.data("onblur")&&this.data("onblur")(e,this));return this},BB.gmap.controller.prototype.set_focus=function(t){if(this.data("multiple")||(this.remove_focus(),this.__FOCUSED_ITEM=t),this.data("multiple")){if(this.__FOCUSED_ITEM||(this.__FOCUSED_ITEM={}),void 0!==this.__FOCUSED_ITEM[t.data("ident")])return this.remove_focus(t.data("ident")),this;this.__FOCUSED_ITEM[t.data("ident")]=t}"function"==typeof this.data("onfocus")&&this.data("onfocus")(t,this);return this},BB.gmap.controller.prototype.focused=function(t){if(this.__FOCUSED_ITEM){if(this.data("multiple")&&t){if(void 0===this.__FOCUSED_ITEM)return;return void 0!==this.__FOCUSED_ITEM[t]?this.__FOCUSED_ITEM[t]:void 0}return t?this.__FOCUSED_ITEM.data("ident")===t?this.__FOCUSED_ITEM:void 0:this.__FOCUSED_ITEM}},BB.gmap.controller.prototype.translate_coords=function(t){if("object"==typeof t&&2===t.length)return new google.maps.LatLng(t[0],t[1])},BB.gmap.controller.prototype.listeners=function(){var e=this;return google.maps.event.clearListeners(this.map(),"click"),google.maps.event.addListener(this.map(),"click",function(t){e.map_click(t)}),google.maps.event.addListenerOnce(this.map(),"tilesloaded",function(t){e.set_data({tiles_loaded:!0}),e.check_loaded_places()&&e._ready()}),google.maps.event.addDomListener(document,"keyup",function(t){switch(t.keyCode?t.keyCode:t.which){case 46:e.focused()&&e.focused().data("editable")&&(e.focused().delete(),e.remove_focus());break;case 27:e.focused()&&e.remove_focus()}}),this},BB.gmap.controller.prototype.create_new=function(t,e){var o=this;if(e=e||"new_object",this.get_place(e))return!1;var i=this.default_styles();switch(t){case"polygon":var s={type:"polygon",editable:!0,styles:i},r=new BB.gmap.polygon(s,o);o.set_place(e,r),o.set_focus(r);break;case"line":s={type:"line",editable:!0,styles:i};var n=new BB.gmap.line(s,o);o.set_place(e,n),o.set_focus(n);break;default:this.set_data({marker_creation:e})}},BB.gmap.controller.prototype.on=function(t,e){var o={};o["on"+t]=e,this.set_data(o)},BB.gmap.controller.prototype.map_click=function(t){this.data("marker_creation")&&(this.add_place(this.data("marker_creation"),{coords:[t.latLng.lat(),t.latLng.lng()],draggable:!0,editable:!0,type:"marker"}),this.set_focus(this.get_place(this.data("marker_creation"))),"function"==typeof this.data("marker_creation_callback")&&this.data("marker_creation_callback")(this.get_place(this.data("marker_creation"))));var e=this.focused();return e&&(e.map_click(t),this.remove_focus()),this},BB.gmap.controller.prototype._loop_all=function(t){if("function"!=typeof t)return this;var e=this.get_places();for(var o in e)t(e[o]);return this},BB.gmap.controller.prototype.filter=function(s){this._loop_all(function(t){if(!s)return t.show(),!1;var e=t.data("categories");if(!e)return t.hide(),!1;"string"==typeof e&&(e=e.split(",")),e||t.hide();var o=!1;for(var i in e)s===e[i]&&(o=!0);o?t.show():t.hide()})},BB.gmap.controller.prototype.fit_bounds=function(){var r=new google.maps.LatLngBounds,n=0;if(this._loop_all(function(t){var e,o=t.get_position();if(!o)return!1;if(o instanceof google.maps.LatLng)r.extend(o);else for(var i=0;i<o.getLength();i++){e=o.getAt(i);for(var s=0;s<e.getLength();s++)r.extend(e.getAt(s))}n++}),0<n&&(this.map().fitBounds(r),this.data("max_fitbounds_zoom"))){var t=this.data("max_fitbounds_zoom");t<this.map().getZoom()&&this.map().setZoom(t)}return this},BB.gmap.controller.prototype.get_all_markers=function(){var t=[],e=this.get_places();for(var o in e){var i=e[o];"marker"===i.data("type")&&t.push(i.object())}return t},BB.gmap.controller.prototype.activate_clusterer=function(){this.clusterer()&&this.clusterer().clearMarkers();var t=this.get_all_markers(),e=this.data("clusterer_options")||{};return this.set_clusterer(new MarkerClusterer(this.map(),t,e)),this},BB.gmap.controller.prototype.set_clusterer=function(t){this.__CLUSTERER=t},BB.gmap.controller.prototype.clusterer=function(){return this.__CLUSTERER},BB.gmap.controller.prototype._delete=function(t){return void 0!==this.get_places()[t]&&(delete this.__PLACES[t],!0)},BB.gmap.controller.prototype.export=function(){var e=this.data();void 0!==e.places&&delete e.places,void 0!==e.center&&delete e.center;var t=this.map().getCenter();return e.map.center.x=t.lat(),e.map.center.y=t.lng(),e.map.zoom=this.map().getZoom(),e.places={},this._loop_all(function(t){e.places[t.ident()]=t.export()}),e},BB.gmap.controller.prototype.get_map_image=function(){var t=this.map().getCenter(),e="https://maps.googleapis.com/maps/api/staticmap?",l=[];return l.push("center="+t.lat()+","+t.lng()),l.push("zoom="+this.map().getZoom()),l.push("size=640x400"),this._loop_all(function(t){if("marker"==t.data("type")){if(!t.data("icon").src)return!1;var e=new Image;e.src=t.data("icon").src;var o=t.data("icon").width+"x"+t.data("icon").height,i=t.data("coords"),s="markers=size:"+o+"|icon:"+e.src+"|"+i[0]+","+i[1];l.push(s)}if("polygon"===t.data("type")){var r=t.data("paths");if(!r)return!1;var n=[],a=t.data("styles"),p=(a.strokeColor,a.strokeWeight);a.fillColor;n.push("color:black"),n.push("weight:"+p),n.push("fillcolor:white");for(var h=0,c=r.length;h<c;h++)n.push(r[h].join(","));n.push(r[0].join(",")),l.push("path="+n.join("|"))}}),e+=l.join("&")},BB.gmap.controller.prototype.reset=function(){return this._loop_all(function(t){t.hide(),t.delete()}),this.set_data({places:void 0}),this.remove_focus(),this},BB.gmap.controller.prototype.default_styles=function(){return this.data("default_styles")?this.data("default_styles"):{strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FFFFFF",fillOpacity:.35,hover:{strokeColor:"#000000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FFFFFF",fillOpacity:1},focused:{fillOpacity:1}}},(BB=BB||{}).gmap=BB.gmap||{},BB.gmap.statics=BB.gmap.statics||{},BB.gmap.infobox=function(t,e,o){this.__MAP=void 0,this.__MARKER=o,this.infoboxContent=t,this.__ELEM=void 0,google.maps.OverlayView.call(this),e.offsetY=e.offsetY||0,e.offsetX=e.offsetX||0,e.multiple=e.multiple||!1,this.opts=e,void 0===this.opts.placement&&(this.opts.placement="top center"),this.__MAP=e.map,this.set_map(e.map)},(BB=BB||{}).gmap=BB.gmap||{},BB.gmap.object=function(t,e){return this._controller=e,this._options=this.parse_options(t),this.__DELETED=!1,this.set_data(this._options),this.set_object(this.create_object()),this.init(),this.controller().loading_place(this.ident()),this},BB.gmap.object.prototype=new BB.base,BB.gmap.object.prototype.set_object=function(t){return this._object=t,this},BB.gmap.object.prototype.object=function(){return this._object},BB.gmap.object.prototype.controller=function(){return this._controller},BB.gmap.object.prototype.set_controller=function(t){return this._controller=t,this},BB.gmap.object.prototype.set_map=function(t){return this.object().setMap(t),this},BB.gmap.object.prototype.convert_recursive_array_to_lat_lng=function(t){if(2===t.length&&"object"!=typeof t[0]&&"object"!=typeof t[1])return{lat:parseFloat(t[0]),lng:parseFloat(t[1])};for(var e in t)"object"==typeof t[e]&&(t[e]=this.convert_recursive_array_to_lat_lng(t[e]));return t},BB.gmap.object.prototype.map_click=function(t){return this},BB.gmap.object.prototype.show=function(){return this.set_map(this.controller().map()),this},BB.gmap.object.prototype.hide=function(){return this.set_map(null),this},BB.gmap.object.prototype.delete=function(){if(this.__DELETED=!0,void 0===this.object())return this.error("No object defined at BB.gmap.object.delete()"),this;this.clear_listeners(),this.set_map(null);var t=this.data();return"function"==typeof t.ondelete&&t.ondelete(this),this.controller()._delete(this.data("type"),this.ident()),this},BB.gmap.object.prototype.parse_options=function(t){return t},BB.gmap.object.prototype.create_object=function(){},BB.gmap.object.prototype.init=function(){return this},BB.gmap.object.prototype.display=function(){return this},BB.gmap.object.prototype.focus=function(){return this},BB.gmap.object.prototype.blur=function(){return this},BB.gmap.object.prototype.get_bounds=function(){return this},BB.gmap.object.prototype.get_position=function(){return this},BB.gmap.object.prototype.clear_listeners=function(){return this},BB.gmap.object.prototype.export=function(){return this.data()},(BB=BB||{}).gmap=BB.gmap||{},BB.gmap.statics=BB.gmap.statics||{},BB.gmap.marker=function(t,e){return BB.gmap.object.call(this,t,e),this._image=void 0,this._ready=!1,this._image_loaded=!1,this._marker_loaded=!1,this.__INFOBOX=void 0,this._listeners=!1,this},BB.gmap.marker.prototype=Object.create(BB.gmap.object.prototype),BB.gmap.marker.prototype.create_object=function(){return new google.maps.Marker(this._options)},BB.gmap.marker.prototype.parse_options=function(t){return delete t.type,t.position=this.convert_recursive_array_to_lat_lng(t.position),t},BB.gmap.marker.prototype.init=function(){return console.log(this.object()),this.show(),this},BB.gmap.marker.prototype.set_image=function(t,e,o){if("string"==typeof t&&(t={src:t}),"object"!=typeof t)return this;var i=new Image;return i.data=this,i.onload=function(){"function"==typeof e&&e()},i.onerror=function(){"function"==typeof o&&o()},i.src=t.src,void 0!==t.width&&(i.width=t.width),void 0!==t.height&&(i.height=t.height),this._image=i,this},BB.gmap.marker.prototype.display=function(){var t,e,o=this.icon();o instanceof Image||"string"==typeof o.path&&(void 0!==o.height&&"object"!=typeof o.height&&(t=parseInt(o.height)),void 0!==o.width&&"object"!=typeof o.width&&(e=parseInt(o.width)),o.anchor=new google.maps.Point(e/2,t),options.icon=o);var i="object"==typeof _data.options?_data.options:{};for(var s in i)options[s]=i[s];if(this.icon().src&&(e=parseFloat(this.icon().width),t=parseFloat(this.icon().height),options.icon=new google.maps.MarkerImage(this.icon().src,new google.maps.Size(e,t),new google.maps.Point(0,0),new google.maps.Point(e/2,t),new google.maps.Size(e,t))),void 0!==this.object())this.object().setOptions(options);else{var r=new google.maps.Marker(options);this.set_marker(r)}return this._listeners||(this.listeners(),this._listeners=!0,this.marker_loaded()),this.data("hidden")&&this.hide(),this},BB.gmap.marker.prototype.marker_loaded=function(){var t=this.data();return"function"==typeof t.loaded_callback&&t.loaded_callback(this),this.controller().data("use_clusterer")&&this.controller().activate_clusterer(),this.controller().place_loaded(this),this},BB.gmap.marker.prototype.set_marker=function(t){return this._marker_loaded?this.error("There is already a marker affected to this instanciation of a [BB.gmap.marker] ( "+this.ident()+" )"):(this._marker_loaded=!0,this.set_object(t)),this},BB.gmap.marker.prototype.listeners=function(){var t=this.object();(t.bbobject=this).data("draggable")&&google.maps.event.addListener(t,"dragend",this.dragend),google.maps.event.addListener(this.object(),"click",this.onclick),google.maps.event.addListener(this.object(),"mouseover",this.mouse_over),google.maps.event.addListener(this.object(),"mouseout",this.mouse_out)},BB.gmap.marker.prototype.clear_listeners=function(){return google.maps.event.clearListeners(this.object(),"mouseover"),google.maps.event.clearListeners(this.object(),"mouseout"),google.maps.event.clearListeners(this.object(),"click"),this.data("draggable")&&google.maps.event.clearListeners(this.object(),"dragend"),this},BB.gmap.marker.prototype.dragend=function(t){var e=this.bbobject,o=e.data();"function"==typeof o.ondragend&&o.ondragend(e,t),e.set_data({coords:[t.latLng.lat(),t.latLng.lng()]}),e.focus()},BB.gmap.marker.prototype.onclick=function(t){var e=this.bbobject,o=e.data();"function"==typeof o.onclick?o.onclick(t,e):"string"==typeof o.onclick&&"function"==typeof window[o.onclick]&&window[o.onclick](e,t),e.focus()},BB.gmap.marker.prototype.mouse_over=function(t){var e=this.bbobject,o=e.data();"function"==typeof o.onmouseover&&o.onmouseover(e,t)},BB.gmap.marker.prototype.mouse_out=function(t){var e=this.bbobject,o=e.data();"function"==typeof o.onmouseout&&o.onmouseout(e,t)},BB.gmap.marker.prototype.focus=function(){this.check_infobox(!0),this.controller().set_focus(this);var t=this.data();t.icon_selected&&("object"==typeof t.icon_selected?this.set_icon(t.icon_selected):this.set_image(t.icon_selected))},BB.gmap.marker.prototype.blur=function(){if(this.check_infobox(!1),!this.controller().get_place(this.ident()))return!1;var t=this.data();t.icon_selected&&("object"==typeof t.icon?this.set_icon(t.icon):this.set_image(t.icon))},BB.gmap.marker.prototype.check_infobox=function(t){var e=this,o=this.data();if(o.infobox){if(e.__INFOBOX)return e.__INFOBOX.map&&!t?e.__INFOBOX.set_map(null):t&&(e.__INFOBOX.set_position(e.object().getPosition()),e.__INFOBOX.set_map(e.controller().map())),this;BB.gmap.statics.infobox_loaded||(init_infoBox(),BB.gmap.statics.infobox_loaded=!0);var i={};o.infobox_options&&(i=o.infobox_options),i.offsetY||(i.offsetY=e.icon().height),i.offsetX||(i.offsetX=e.icon().width/2),i.map=e.controller().map(),i.position=e.get_position(),e.__INFOBOX=new BB.gmap.infobox(o.infobox,i,e)}},BB.gmap.marker.prototype.get_bounds=function(){var t=new google.maps.LatLngBounds;return t.extend(this.object().getPosition()),t},BB.gmap.marker.prototype.get_position=function(){if(this.object())return this.object().getPosition()},BB.gmap.marker.prototype.set_position=function(t){if(!t)return this;if("string"==typeof t&&(t=t.split(",")),!(t instanceof google.maps.LatLng)){if(void 0===t[0]||void 0===t[1])return this;t=new google.maps.LatLng(t[0],t[1])}return this.object().setPosition(t),this.set_data({coords:[t.lat(),t.lng()]}),this.__INFOBOX&&this.__INFOBOX.set_position(t),this},(BB=BB||{}).gmap=BB.gmap||{},BB.gmap.statics=BB.gmap.statics||{},BB.gmap.richmarker=function(t,e){return BB.gmap.marker.call(this,t,e),this._listeners=!1,this},BB.gmap.richmarker.prototype=Object.create(BB.gmap.marker.prototype),BB.gmap.richmarker.prototype.init=function(){var t=this.data();return this.set_content(t.content),this.display(),this},BB.gmap.richmarker.prototype.set_content=function(t){return this._content=t,this},BB.gmap.richmarker.prototype.content=function(){return this._content},BB.gmap.richmarker.prototype.display=function(){var t=this.data();if("object"!=typeof t.coords)return this.error("Requires coordinates [lat, lng] at BB.gmap.richmarker.display()"),!1;var e={map:this.controller().map(),position:new google.maps.LatLng(t.coords[0],t.coords[1])};if("function"==typeof(e=this.extend(e,t)).html&&(e.html=e.html(t)),"function"==typeof e.selected_html&&(e.selected_html=e.selected_html(t)),void 0!==this.object())this.object().setOptions(e);else{var o=customMarker(e);this.set_marker(o)}return this._listeners||(this.listeners(),this._listeners=!0,this.controller().place_loaded(this)),this.data("hidden")&&this.hide(),this},BB.gmap.richmarker.prototype.listeners=function(){var t=this.object();(t.bbobject=this).data("draggable")&&google.maps.event.addListener(t,"dragend",this.dragend),google.maps.event.addListener(t,"click",this.onclick)},BB.gmap.richmarker.prototype.clear_listeners=function(){var t=this.object();return google.maps.event.clearListeners(t,"dragend"),google.maps.event.clearListeners(t,"click"),this},BB.gmap.richmarker.prototype.focus=function(){if(this.check_infobox(!0),this.controller().focused()&&this.controller().focused().ident()==this.ident())return this;if(this.controller().set_focus(this),this.data("selected_html")){var t=this.data("selected_html");"function"==typeof t&&(t=t(this.data())),this.object().setHtml(t)}},BB.gmap.richmarker.prototype.blur=function(){if(this.check_infobox(!1),!this.controller().get_place(this.ident()))return!1;var t=this.data("html");"function"==typeof t&&(t=t(this.data())),this.object().setHtml(t)},BB.gmap.richmarker.prototype.icon=function(){return{height:this.object().div.offsetHeight,width:this.object().div.offsetWidth}},customMarker=function(t){return"function"!=typeof BB.gmap.customMarker&&(BB.gmap.customMarker=function(t){this.dirty=!0,this.MAP=t.map,void 0!==t.map&&this.setMap(this.MAP),void 0!==t.position&&(this.latlng=t.position),void 0!==t.html&&(this.html=t.html)},BB.gmap.customMarker.prototype=new google.maps.OverlayView,BB.gmap.customMarker.prototype.draw=function(){this.dirty&&(this.updateHtml(),this.dirty=!1),this.setPositionFromDraw()},BB.gmap.customMarker.prototype.setPositionFromDraw=function(){var t=this.div;if(!t)return this;if(!this.getProjection())return this;var e=this.getProjection().fromLatLngToDivPixel(this.latlng);if(e){var o=t.offsetHeight,i=t.offsetWidth;t.style.left=e.x-i/2+"px",t.style.top=e.y-o+"px"}return this.div=t,this},BB.gmap.customMarker.prototype.updateHtml=function(){var e=this,t=this.div;if(!t){(t=document.createElement("div")).style.position="absolute",t.style.cursor="pointer",google.maps.event.addDomListener(t,"click",function(t){t.stopPropagation(),t.preventDefault(),google.maps.event.trigger(e,"click")});var o=this.getPanes();o&&o.overlayImage.appendChild(t)}t.innerHTML=this.html,this.div=t},BB.gmap.customMarker.prototype.setHtml=function(t){this.html=t,this.dirty=!0,this.updateHtml(),this.setPositionFromDraw()},BB.gmap.customMarker.prototype.remove=function(){this.div&&(this.div.parentNode.removeChild(this.div),this.div=null)},BB.gmap.customMarker.prototype.setPosition=function(t){this.latlng=t,this.draw()},BB.gmap.customMarker.prototype.getPosition=function(){return this.latlng}),new BB.gmap.customMarker(t)},(BB=BB||{}).gmap=BB.gmap||{},BB.gmap.line=function(t,e){return BB.gmap.object.call(this,t,e),this},BB.gmap.line.prototype=Object.create(BB.gmap.object.prototype),BB.gmap.line.prototype.create_object=function(){return new google.maps.Polyline(this._options)},BB.gmap.line.prototype.parse_options=function(t){return delete t.type,t.path=this.convert_recursive_array_to_lat_lng(t.path),void 0===t.styles&&(t.styles=this.controller().default_styles()),t},BB.gmap.line.prototype.init=function(){return this.listeners(),this.show(),this.controller().place_loaded(this),this},BB.gmap.line.prototype.get_path=function(){return this.object().getPath()},BB.gmap.line.prototype.set_path=function(t){return t=this.convert_recursive_array_to_lat_lng(t),this.object().setPath(t),this},BB.gmap.line.prototype.set_styles=function(t){return this.object().setOptions(t),this},BB.gmap.line.prototype.get_styles=function(){return this._options.styles},BB.gmap.line.prototype.add_point=function(t,e){if("object"!=typeof t)return!1;if(t instanceof google.maps.LatLng&&(t=[t.lat(),t.lng()]),!(t instanceof google.maps.LatLng||void 0!==t[0]&&void 0!==t[1]))return!1;var o=this,i=this.get_path();if(void 0===i&&this.set_path([[t.lat(),t.lng()]]),i=this.get_path(),"number"!=typeof e&&(e=i.length),i.push(t),this.set_path(i),this.data("editable")){var s=new BB.gmap.marker({coords:t,draggable:!0,icon:{path:google.maps.SymbolPath.CIRCLE,scale:4},editable:!0,ondragend:function(t,e){o.move_point(t.object().index,[e.latLng.lat(),e.latLng.lng()])},ondelete:function(t){o.remove_point(t.object().index),o.focus(),o.get_path().length||o.delete()},index:e},o.controller());this.__MARKERS||(this.__MARKERS=[]),this.__MARKERS[e]=s}return this},BB.gmap.line.prototype.map_click=function(t){},BB.gmap.line.prototype.listeners=function(){(this.object().bbobject=this).clear_listeners(),google.maps.event.addListener(this.object(),"mouseover",this.mouse_over),google.maps.event.addListener(this.object(),"mouseout",this.mouse_out),google.maps.event.addListener(this.object(),"click",this.click)},BB.gmap.line.prototype.clear_listeners=function(){return google.maps.event.clearListeners(this.object(),"mouseover"),google.maps.event.clearListeners(this.object(),"mouseout"),google.maps.event.clearListeners(this.object(),"click"),this},BB.gmap.line.prototype.mouse_over=function(t){var e=this.bbobject,o=e.data();"function"==typeof o.onmouseover&&o.onmouseover(e,t);var i=e.get_data("styles");"object"==typeof i.hover&&e.set_styles(i.hover)},BB.gmap.line.prototype.mouse_out=function(t){var e=this.bbobject,o=e.data();"function"==typeof o.onmouseout&&o.onmouseout(e,t);var i=e.get_data("styles");e.controller().focused(e.data("ident"))?"object"==typeof i.focused&&e.set_styles(i.focused):e.set_styles(i)},BB.gmap.line.prototype.mouse_down=function(t){this.bbobject},BB.gmap.line.prototype.mouse_up=function(t){this.bbobject},BB.gmap.line.prototype.click=function(t){var e=this.bbobject,o=e.data();e.focus(),"function"==typeof o.onclick?o.onclick(e,t):"string"==typeof o.onclick&&"function"==typeof window[o.onclick]&&window[o.onclick](e,t)},BB.gmap.line.prototype.focus=function(){if(this.__DELETED)return!1;if(!this.controller().focused(this.data("ident"))){var t=this.get_data("styles");"object"==typeof t.focused&&this.set_styles(t.focused)}return this.controller().set_focus(this),this},BB.gmap.line.prototype.blur=function(){return!this.__DELETED&&(this.set_styles(this.get_data("styles")),this)},BB.gmap.line.prototype.get_bounds=function(){for(var t=new google.maps.LatLngBounds,e=this.object().getPaths(),o=0;o<e.getLength();o++){e.getAt(o);for(var i=0;i<e.getLength();i++)t.extend(e.getAt(i))}return t},BB.gmap.line.prototype.get_position=function(){var t=new google.maps.MVCArray;return t.push(this.object().getPath()),t},BB.gmap.line.prototype.update_coords=function(){this.get_path();return this},BB.gmap.line.prototype.export=function(){var t=this.data();return void 0!==t.styles.path&&delete t.styles.path,this.data()},BB.gmap.line.prototype.delete=function(){var t=0,e=this.__MARKERS.length;if(e)for(;t<e;t++)this.remove_point(t);this.hide_markers(),BB.gmap.object.prototype.delete.call(this)},(BB=BB||{}).gmap=BB.gmap||{},BB.gmap.polygon=function(t,e){return BB.gmap.line.call(this,t,e),this},BB.gmap.polygon.prototype=Object.create(BB.gmap.line.prototype),BB.gmap.polygon.prototype.create_object=function(){return new google.maps.Polygon(this._options)},BB.gmap.polygon.prototype.parse_options=function(t){return delete t.type,t.paths=this.convert_recursive_array_to_lat_lng(t.paths),t=void 0===t.styles?Object.assign(t,this.controller().default_styles()):Object.assign(t,t.styles)},BB.gmap.polygon.prototype.get_paths=function(){return this.__PATHS},BB.gmap.polygon.prototype.set_paths=function(t){this.__PATHS=this.convert_recursive_array_to_lat_lng(t),this.object().setPaths(this.__PATHS)},BB.gmap.polygon.prototype.get_position=function(){return this.object().getPaths()},function(){var t,g=null;function e(e){return function(t){this[e]=t}}function o(t){return function(){return this[t]}}function s(t,e,o){this.extend(s,google.maps.OverlayView),this.c=t,this.a=[],this.f=[],this.ca=[53,56,66,78,90],this.j=[],this.A=!1,o=o||{},this.g=o.gridSize||60,this.l=o.minimumClusterSize||2,this.J=o.maxZoom||g,this.j=o.styles||[],this.X=o.imagePath||this.Q,this.W=o.imageExtension||this.P,this.O=!0,null!=o.zoomOnClick&&(this.O=o.zoomOnClick),this.r=!1,null!=o.averageCenter&&(this.r=o.averageCenter),function(t){if(!t.j.length)for(var e,o=0;e=t.ca[o];o++)t.j.push({url:t.X+(o+1)+"."+t.W,height:e,width:e})}(this),this.setMap(t),this.K=this.c.getZoom();var i=this;google.maps.event.addListener(this.c,"zoom_changed",function(){var t=i.c.getZoom();i.K!=t&&(i.K=t,i.m())}),google.maps.event.addListener(this.c,"idle",function(){i.i()}),e&&e.length&&this.C(e,!1)}function r(t,e){e.s=!1,e.draggable&&google.maps.event.addListener(e,"dragend",function(){e.s=!1,t.L()}),t.a.push(e)}function n(t,e){var o=-1;if(t.a.indexOf)o=t.a.indexOf(e);else for(var i,s=0;i=t.a[s];s++)if(i==e){o=s;break}return-1!=o&&(e.setMap(g),t.a.splice(o,1),!0)}function i(t){if(t.A)for(var e,o=t.v(new google.maps.LatLngBounds(t.c.getBounds().getSouthWest(),t.c.getBounds().getNorthEast())),i=0;e=t.a[i];i++)if(!e.s&&o.contains(e.getPosition())){for(var s=t,r=4e4,n=g,a=0,p=void 0;p=s.f[a];a++){if(d=p.getCenter()){var h=e.getPosition();if(d&&h){var c=(h.lat()-d.lat())*Math.PI/180,l=(h.lng()-d.lng())*Math.PI/180,d=Math.sin(c/2)*Math.sin(c/2)+Math.cos(d.lat()*Math.PI/180)*Math.cos(h.lat()*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);d=12742*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))}else d=0;d<r&&(r=d,n=p)}}n&&n.F.contains(e.getPosition())?n.q(e):((p=new u(s)).q(e),s.f.push(p))}}function u(t){this.k=t,this.c=t.getMap(),this.g=t.w(),this.l=t.l,this.r=t.r,this.d=g,this.a=[],this.F=g,this.n=new p(this,t.z(),t.w())}function a(t){t.F=t.k.v(new google.maps.LatLngBounds(t.d,t.d))}function p(t,e,o){t.k.extend(p,google.maps.OverlayView),this.j=e,this.fa=o||0,this.u=t,this.d=g,this.c=t.getMap(),this.B=this.b=g,this.t=!1,this.setMap(this.c)}function h(t,e){var o=t.getProjection().fromLatLngToDivPixel(e);return o.x-=parseInt(t.p/2,10),o.y-=parseInt(t.h/2,10),o}function c(t){t.b&&(t.b.style.display="none"),t.t=!1}function l(t,e){var o=[];return o.push("background-image:url("+t.da+");"),o.push("background-position:"+(t.D?t.D:"0 0")+";"),"object"==typeof t.e?("number"==typeof t.e[0]&&0<t.e[0]&&t.e[0]<t.h?o.push("height:"+(t.h-t.e[0])+"px; padding-top:"+t.e[0]+"px;"):o.push("height:"+t.h+"px; line-height:"+t.h+"px;"),"number"==typeof t.e[1]&&0<t.e[1]&&t.e[1]<t.p?o.push("width:"+(t.p-t.e[1])+"px; padding-left:"+t.e[1]+"px;"):o.push("width:"+t.p+"px; text-align:center;")):o.push("height:"+t.h+"px; line-height:"+t.h+"px; width:"+t.p+"px; text-align:center;"),o.push("cursor:pointer; top:"+e.y+"px; left:"+e.x+"px; color:"+(t.M?t.M:"black")+"; position:absolute; font-size:"+(t.N?t.N:11)+"px; font-family:Arial,sans-serif; font-weight:bold"),o.join("")}(t=s.prototype).Q="https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m",t.P="png",t.extend=function(t,e){return function(t){for(var e in t.prototype)this.prototype[e]=t.prototype[e];return this}.apply(t,[e])},t.onAdd=function(){this.A||(this.A=!0,i(this))},t.draw=function(){},t.S=function(){for(var t,e=this.o(),o=new google.maps.LatLngBounds,i=0;t=e[i];i++)o.extend(t.getPosition());this.c.fitBounds(o)},t.z=o("j"),t.o=o("a"),t.V=function(){return this.a.length},t.ba=e("J"),t.I=o("J"),t.G=function(t,e){for(var o=0,i=t.length,s=i;0!==s;)s=parseInt(s/10,10),o++;return{text:i,index:o=Math.min(o,e)}},t.$=e("G"),t.H=o("G"),t.C=function(t,e){for(var o,i=0;o=t[i];i++)r(this,o);e||this.i()},t.q=function(t,e){r(this,t),e||this.i()},t.Y=function(t,e){var o=n(this,t);return!(e||!o)&&(this.m(),this.i(),!0)},t.Z=function(t,e){for(var o,i=!1,s=0;o=t[s];s++)o=n(this,o),i=i||o;if(!e&&i)return this.m(),this.i(),!0},t.U=function(){return this.f.length},t.getMap=o("c"),t.setMap=e("c"),t.w=o("g"),t.aa=e("g"),t.v=function(t){var e=this.getProjection(),o=new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),i=new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng());return(o=e.fromLatLngToDivPixel(o)).x+=this.g,o.y-=this.g,(i=e.fromLatLngToDivPixel(i)).x-=this.g,i.y+=this.g,o=e.fromDivPixelToLatLng(o),e=e.fromDivPixelToLatLng(i),t.extend(o),t.extend(e),t},t.R=function(){this.m(!0),this.a=[]},t.m=function(t){for(var e,o=0;e=this.f[o];o++)e.remove();for(o=0;e=this.a[o];o++)e.s=!1,t&&e.setMap(g);this.f=[]},t.L=function(){var o=this.f.slice();this.f.length=0,this.m(),this.i(),window.setTimeout(function(){for(var t,e=0;t=o[e];e++)t.remove()},0)},t.i=function(){i(this)},(t=u.prototype).q=function(t){var e;t:if(this.a.indexOf)e=-1!=this.a.indexOf(t);else{e=0;for(var o;o=this.a[e];e++)if(o==t){e=!0;break t}e=!1}if(e)return!1;if(this.d?this.r&&(o=this.a.length+1,e=(this.d.lat()*(o-1)+t.getPosition().lat())/o,o=(this.d.lng()*(o-1)+t.getPosition().lng())/o,this.d=new google.maps.LatLng(e,o),a(this)):(this.d=t.getPosition(),a(this)),t.s=!0,this.a.push(t),(e=this.a.length)<this.l&&t.getMap()!=this.c&&t.setMap(this.c),e==this.l)for(o=0;o<e;o++)this.a[o].setMap(g);if(e>=this.l&&t.setMap(g),t=this.c.getZoom(),(e=this.k.I())&&e<t)for(t=0;e=this.a[t];t++)e.setMap(this.c);else this.a.length<this.l?c(this.n):(e=this.k.H()(this.a,this.k.z().length),this.n.setCenter(this.d),(t=this.n).B=e,t.ga=e.text,t.ea=e.index,t.b&&(t.b.innerHTML=e.text),e=Math.max(0,t.B.index-1),e=Math.min(t.j.length-1,e),e=t.j[e],t.da=e.url,t.h=e.height,t.p=e.width,t.M=e.textColor,t.e=e.anchor,t.N=e.textSize,t.D=e.backgroundPosition,this.n.show());return!0},t.getBounds=function(){for(var t,e=new google.maps.LatLngBounds(this.d,this.d),o=this.o(),i=0;t=o[i];i++)e.extend(t.getPosition());return e},t.remove=function(){this.n.remove(),this.a.length=0,delete this.a},t.T=function(){return this.a.length},t.o=o("a"),t.getCenter=o("d"),t.getMap=o("c"),(t=p.prototype).onAdd=function(){this.b=document.createElement("DIV"),this.t&&(this.b.style.cssText=l(this,h(this,this.d)),this.b.innerHTML=this.B.text),this.getPanes().overlayMouseTarget.appendChild(this.b);var e=this;google.maps.event.addDomListener(this.b,"click",function(){var t=e.u.k;google.maps.event.trigger(t,"clusterclick",e.u),t.O&&e.c.fitBounds(e.u.getBounds())})},t.draw=function(){if(this.t){var t=h(this,this.d);this.b.style.top=t.y+"px",this.b.style.left=t.x+"px"}},t.show=function(){this.b&&(this.b.style.cssText=l(this,h(this,this.d)),this.b.style.display=""),this.t=!0},t.remove=function(){this.setMap(g)},t.onRemove=function(){this.b&&this.b.parentNode&&(c(this),this.b.parentNode.removeChild(this.b),this.b=g)},t.setCenter=e("d"),(window.MarkerClusterer=s).prototype.addMarker=s.prototype.q,s.prototype.addMarkers=s.prototype.C,s.prototype.clearMarkers=s.prototype.R,s.prototype.fitMapToMarkers=s.prototype.S,s.prototype.getCalculator=s.prototype.H,s.prototype.getGridSize=s.prototype.w,s.prototype.getExtendedBounds=s.prototype.v,s.prototype.getMap=s.prototype.getMap,s.prototype.getMarkers=s.prototype.o,s.prototype.getMaxZoom=s.prototype.I,s.prototype.getStyles=s.prototype.z,s.prototype.getTotalClusters=s.prototype.U,s.prototype.getTotalMarkers=s.prototype.V,s.prototype.redraw=s.prototype.i,s.prototype.removeMarker=s.prototype.Y,s.prototype.removeMarkers=s.prototype.Z,s.prototype.resetViewport=s.prototype.m,s.prototype.repaint=s.prototype.L,s.prototype.setCalculator=s.prototype.$,s.prototype.setGridSize=s.prototype.aa,s.prototype.setMaxZoom=s.prototype.ba,s.prototype.onAdd=s.prototype.onAdd,s.prototype.draw=s.prototype.draw,u.prototype.getCenter=u.prototype.getCenter,u.prototype.getSize=u.prototype.T,u.prototype.getMarkers=u.prototype.o,p.prototype.onAdd=p.prototype.onAdd,p.prototype.draw=p.prototype.draw,p.prototype.onRemove=p.prototype.onRemove}();